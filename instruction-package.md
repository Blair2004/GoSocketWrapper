We'll create a laravel package named "GoSocketWrapper" that will interact with the socket application we're creating named "GoSocket". As you might know, this application is composed of a socket and HTTP server. The package will allow communication with the socket application by any compatible laravel application. You'll store the package on the directory "package".


Let's talk about the requirements:

- Laravel 12
- php 5.3
- composer package: lcobucci/jwt (used to generate and validate JWT)

Key Features:
=============
- Command to generate socket actions
- Mechanism to detect Actions on specified directory. We'll use the config to allow user to provide path (comma separated) for scanning. 
- Uses Event Dispatch to send message to clients

Security Concern:
=================
The connexion to the HTTP server requires to provide a token. That token must match the token used to launch GoSocket. We might then require the user to specify the token on the .env file. The access to GoSocket doesn't requires authentication. However, for creating, joining, leaving, messaging within a private channel, the client must authenticate first. The package will include a proper JS socket client for an easy integration. That client must allow to configure the socket with options such as:
- socket address
- debug
- ping-pong interval

Migration:
==========
The package will create a migration to update the user table. It will add a column named "socket_jwt". It's where the socket_jwt will be stored.

Generating JWT
==============
This token is generated when the user is logging in. You can inspire from the listener available here: php/ValidatedListener.php to understand how to generate that JWT token.

Handle Socket Message:
======================
We'll have a command that will be used to process socket message. The idea is that, GoSocket will use that command to foward message to Laravel. the command can be: "php artisan socket:handle --path" where "path" is a link to a payload generated by GoSocket. The way we know which action to trigger depends on the payload. As the payload include a "action" entry, this is used to detect the Action. An action can have a shortname or not (if not the class name is used) The comparison is therefore made with that to know what actions to trigger. To ease your work, you have this file "php/SocketHandlerCommand.php" that should be used as an example. While it's specific to NexoPOS, you'll make it work for any laravel app. We'll also make sure to allow support of custom handler. As we don't want to hardcode it for NexoPOS, we'll creater a service provider where custom handlers can be registered. 

Unlike on SocketHandlerCommand.php, to the variable $middlewares, you'll load middlewares defined on the method "middlewares" by the loaded action. We'll make sure to process only unique middleware (in case there are repeated middleware).

Blade For Socket Client
=======================
We'll make thing easier for user and allow them to just use any of these (@socketClient, @socket, @socket-client) to integrate the socket client.

Socket Action
==========
These are message sent from client to GoSocket and then to Laravel. By default, actions are stored on the directory app/Socket/Actions. A socket actions class will implement an interface that will define the shape of the action. The action has then, "handle" to handle the request with the payload, "middlewares", which returns middlewares that needs to be processed before the requests reaches the "handle" method, "getName" what will define the shortname of the Action. We might use the class name if it's not specificied. "autoload" which returns a boolean set if the actions shoudl load automatically. You can inspire from this interface "php/Action.php"

Authentication Detection
=======================
GoSocket foward the payload to Laravel. That payload has an "auth" entry, which includes the "email" and "id" of the user performing the actions.

Middleware:
===========
By default, we'll create default middleware:
- a middleware to rate limit messages per clients per seconds (if possible)
- a midleware to enforce authentication

Event Dispatching:
============
We'll rely on the default Laravel mechanism to listen every event dispatched. We'll make sure to only capture events that use trait "InteractsWithSockets". We can check it by detecting available method (broadcastToEveryone, dontBroadcastToCurrentUser). The event will be dispatched as an HTTP request to socket server. 

